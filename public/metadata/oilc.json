// updateMetadata.ts
// Updates the metadata URI of the existing Vault NFT to the correct projectc3.xyz version

import { Connection, Keypair, PublicKey } from "@solana/web3.js";
import { Metaplex, keypairIdentity } from "@metaplex-foundation/js";
import dotenv from "dotenv";
import fs from "fs";

dotenv.config();

const main = async () => {
  const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

  // Load wallet keypair (the update authority wallet)
  const secret = JSON.parse(fs.readFileSync(process.env.KEYPAIR_PATH!, "utf8"));
  const wallet = Keypair.fromSecretKey(new Uint8Array(secret));

  const metaplex = Metaplex.make(connection).use(keypairIdentity(wallet));

  const mintAddress = new PublicKey("Fn2My1FYy5fJi7xmg2gWgNUD8M8RnqWpjdpxDBrXmEtC");

  const metadata = await metaplex.nfts().findByMint({ mintAddress });

  const updatedMetadataUri = "https://projectc3.xyz/oilcoin/metadata.json";

  const { response } = await metaplex.nfts().update({
    nftOrSft: metadata,
    uri: updatedMetadataUri
  });

  console.log("âœ… Metadata URI updated:", response.signature);
};

main().catch(console.error);
